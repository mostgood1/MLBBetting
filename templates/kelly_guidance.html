<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kelly Guidance</title>
  <style>
    body { font-family: Inter, Segoe UI, Arial, sans-serif; background:#0b1e39; color:#111; margin:0; }
    .container { max-width:1100px; margin:0 auto; padding:24px; }
    .card { background:#fff; border-radius:14px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.15); margin-bottom:18px; }
    h1 { color:#163a6b; }
    .btn { background:#163a6b; color:#fff; padding:10px 16px; border:none; border-radius:10px; cursor:pointer; text-decoration:none; display:inline-block; }
    .btn.secondary { background:#2a74dc; }
    .muted { color:#666; font-size:13px; }
    .input { padding:8px 10px; border-radius:8px; border:1px solid #cfe1f8; }
  .badge { padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700; }
  .badge.HIGH { background:#16a34a; color:#fff; }
  .badge.MEDIUM { background:#2563eb; color:#fff; }
  .badge.LOW { background:#eab308; color:#111; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
      <div>
        <h1 style="margin:0;">ðŸŽ¯ Kelly Guidance</h1>
        <div class="muted">Size bets using Kelly Criterion with your bankroll and unit preferences.</div>
      </div>
      <div>
        <a class="btn secondary" href="/betting-guidance">â¬… Back to Guidance</a>
      </div>
    </div>

    <div class="card">
      <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <label class="muted">Bankroll</label>
        <input id="kg-bankroll" class="input" type="number" min="100" step="50" value="1000" style="width:110px;"/>
        <label class="muted">Unit</label>
        <input id="kg-unit" class="input" type="number" min="10" step="5" value="100" style="width:90px;"/>
        <label class="muted">Max Units</label>
        <input id="kg-maxunits" class="input" type="number" min="1" step="0.5" value="2" style="width:90px;"/>
        <label class="muted">Kelly Cap</label>
        <input id="kg-cap" class="input" type="number" min="0.05" max="0.5" step="0.01" value="0.25" style="width:90px;"/>
        <button class="btn" onclick="loadKelly()">Load</button>
      </div>
      <div id="kg-info" class="muted" style="margin-top:6px;"></div>
    </div>

    <div id="kg-results"></div>
  </div>

  <script>
    function fmtEV(n){ const v=Number(n); if(!isFinite(v)) return '-'; return (v*100).toFixed(1)+'%'; }
    async function loadKelly(){
      const bankroll = Number(document.getElementById('kg-bankroll').value || 1000);
      const unit = Number(document.getElementById('kg-unit').value || 100);
      const maxUnits = Number(document.getElementById('kg-maxunits').value || 2);
      const cap = Number(document.getElementById('kg-cap').value || 0.25);
      const info = document.getElementById('kg-info');
      const results = document.getElementById('kg-results');
      info.textContent = 'Loading...';
      results.innerHTML = '';
      try{
        const url = `/api/kelly-betting-guidance?bankroll=${encodeURIComponent(bankroll)}&unit=${encodeURIComponent(unit)}&maxUnits=${encodeURIComponent(maxUnits)}&kellyCap=${encodeURIComponent(cap)}`;
        const res = await fetch(url);
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        if(!data.success){ info.textContent='No guidance available.'; return; }
        const g = data.kelly_guidelines||{};
        info.textContent = `Bankroll: $${g.bankroll||bankroll} â€¢ Base Unit: $${g.base_unit||unit} â€¢ Max Single Bet: $${g.max_single_bet||Math.round(unit*maxUnits)} â€¢ Cap: ${g.kelly_cap||Math.round(cap*100)+'%'}`;
        const opps = Array.isArray(data.opportunities)? data.opportunities: [];
        if(!opps.length){ results.innerHTML='<div class="card"><div class="muted">No Kelly opportunities today.</div></div>'; return; }
        let html = '';
        opps.forEach(game=>{
          const bets = game.bets||[];
          const total = game.total_kelly_amount||0;
          html += `<div class=\"card\" style=\"margin:10px 0;\">\n            <div style=\"display:flex; justify-content:space-between; align-items:center;\">\n              <div><strong>${game.game||''}</strong></div>\n              <div class=\"muted\">Total Kelly: $${total}</div>\n            </div>\n            <div style=\"margin-top:8px;\">\n              ${bets.map(b=>`\n                <div style=\"display:flex; justify-content:space-between; gap:10px; padding:8px 0; border-bottom:1px solid #eee;\">\n                  <div>\n                    <div style=\"font-weight:600;\">${b.bet_type||'Bet'} â€¢ <span class=\"badge ${String(b.confidence||'').toUpperCase()}\">${String(b.confidence||'').toUpperCase()}</span></div>\n                    <div class=\"muted\">${b.pick||''}</div>\n                  </div>\n                  <div style=\"text-align:right; min-width:220px;\">\n                    <div>Bet: $${b.suggested_bet||0} â€¢ Odds: ${b.odds>0?'+':''}${b.odds||0}</div>\n                    <div class=\"muted\">Kelly: ${b.kelly_fraction||0}% â€¢ EV: ${typeof b.expected_value==='number'?fmtEV(b.expected_value):b.expected_value||'-'}</div>\n                  </div>\n                </div>\n              `).join('')}\n            </div>\n          </div>`;
        });
        results.innerHTML = html;
      }catch(e){
        info.textContent = 'Failed to load Kelly guidance.';
        results.innerHTML = `<div class=\"card\"><div class=\"muted\">${e.message}</div></div>`;
      }
    }
    document.addEventListener('DOMContentLoaded', ()=>{ try{ loadKelly(); }catch(e){} });
  </script>
</body>
</html>
